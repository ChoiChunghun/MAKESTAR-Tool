<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MAKESTAR 비표 머신</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="EPMVT_Favicon.png" />
  <link rel="apple-touch-icon" href="EPMVT_Favicon.png" />

  <style>
    html, body { height: 100%; margin: 0; background: #0b0b0b; }
    #appFrame { width: 100%; height: 100%; border: 0; display: block; background: #0b0b0b; }
  </style>
</head>
<body>
  <iframe id="appFrame" src=""></iframe>

  <script>
    const NOTION_MANUAL_URL = "https://www.notion.so/makestar/2fbc0f4dd8c8809ab052d2f4e977d7fd?source=copy_link";

    const SIZE_OPTIONS = [
      { value: "93x124", label: "93*124mm / 일반", file: "pass_93x124.html" },
      { value: "96x122", label: "96*122mm / SM", file: "pass_96x122.html" },
      { value: "70x105", label: "70*105mm / 중국 현지 이벤트 1", file: "pass_70x105.html" },
      { value: "73x103", label: "73*103mm / 중국 현지 이벤트 2", file: "pass_73x103.html" },
    ];

    const frame = document.getElementById("appFrame");
    let currentSize = "93x124";

    function loadSize(sizeKey) {
      const opt = SIZE_OPTIONS.find(o => o.value === sizeKey) || SIZE_OPTIONS[0];
      currentSize = opt.value;

      // cache 방지용 쿼리
      frame.src = opt.file + "?v=" + Date.now();
    }

    function injectUI() {
      const doc = frame.contentDocument;
      if (!doc) return;

      // 1) "규격" 드롭다운 (좌측 패널 최상단, H1 아래)
      const panel = doc.querySelector(".panel");
      const h1 = panel ? panel.querySelector("h1") : null;

      if (panel && h1 && !doc.getElementById("badgeSizeSelect")) {
        const row = doc.createElement("div");
        row.className = "row";

        const label = doc.createElement("label");
        label.textContent = "규격";

        const select = doc.createElement("select");
        select.id = "badgeSizeSelect";

        for (const opt of SIZE_OPTIONS) {
          const o = doc.createElement("option");
          o.value = opt.value;
          o.textContent = opt.label;
          select.appendChild(o);
        }
        select.value = currentSize;

        select.addEventListener("change", () => {
          loadSize(select.value);
        });

        row.appendChild(label);
        row.appendChild(select);
        h1.insertAdjacentElement("afterend", row);
      } else {
        const select = doc.getElementById("badgeSizeSelect");
        if (select) select.value = currentSize;
      }

      // 2) "사용자 매뉴얼" (저작권 문장 위, divider 위)
      const footer = doc.querySelector(".panelFooter");
      if (footer && !doc.getElementById("manualLink")) {
        const wrap = doc.createElement("div");
        wrap.id = "panelBottomWrap";
        wrap.style.marginTop = "auto";
        wrap.style.width = "100%";

        const a = doc.createElement("a");
        a.id = "manualLink";
        a.textContent = "사용자 매뉴얼";
        a.href = NOTION_MANUAL_URL;
        a.target = "_blank";
        a.rel = "noopener noreferrer";
        a.style.display = "block";
        a.style.textAlign = "center";
        a.style.color = "rgba(255,255,255,.75)";
        a.style.fontSize = "12px";
        a.style.textDecoration = "underline";
        a.style.paddingTop = "16px";
        a.style.paddingBottom = "10px";

        const parent = footer.parentElement;
        parent.insertBefore(wrap, footer);

        wrap.appendChild(a);

        // footer 원래 border-top(=divider)은 유지
        footer.style.marginTop = "0";
        wrap.appendChild(footer);
      }
    }

    frame.addEventListener("load", () => {
      requestAnimationFrame(injectUI);
    });

    // 기본값: 93*124mm / 일반
    loadSize("93x124");
  </script>
</body>
</html>
